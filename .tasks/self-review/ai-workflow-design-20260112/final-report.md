# AI Workflow Framework Design - Final Report

> **Task ID**: ai-workflow-design-20260112
> **Date**: 2026-01-12
> **Status**: PASS (Reviewed by Codex, 3 rounds)

---

## Executive Summary

基于前期调研结果，设计了一套完整的 AI 编程工作流框架 `agent-flow`，包括：

- **5 阶段工作流模型**: SPECIFY → PLAN → TASK → IMPLEMENT → REVIEW
- **项目级目录结构**: `.agent/` + `.tasks/` 组织规范
- **7 个配置/模板文件**: config.yaml, constitution.md, CLAUDE.md, spec/plan/tasks/structure templates
- **与现有 skills 集成**: self-review, task-planner, codex, research 等

---

## Deliverables

| 文件 | 描述 |
|------|------|
| `workflow-design.md` | 完整设计文档 (450+ 行) |
| `templates/spec.md` | 需求规范模板 |
| `templates/plan.md` | 技术计划模板 |
| `templates/tasks.md` | 任务分解模板 |
| `templates/config.yaml` | 工作流配置模板 |
| `templates/constitution.md` | 项目原则模板 |
| `templates/CLAUDE.md` | Claude 配置模板 |
| `templates/structure.md` | 目录结构模板 |

---

## Key Design Decisions

### 1. 5 阶段模型

```
SPECIFY → PLAN → TASK → IMPLEMENT → REVIEW
```

- 每个阶段有明确的输入/输出
- 关键节点支持人工审批
- REVIEW 阶段集成 self-review skill

### 2. 目录结构

```
.agent/                  # 工作流配置
├── config.yaml          # 配置
├── constitution.md      # 原则
├── specs/{feature}/     # 规范文档
└── templates/           # 模板

.tasks/                  # 执行记录
└── self-review/         # 审查任务
```

### 3. 渐进式采用

| 模式 | 适用场景 | 阶段 |
|------|----------|------|
| Quick | 简单任务 | TASK → IMPLEMENT → Review |
| Full | 复杂功能 | 全部 5 阶段 |
| Research | 技术调研 | RESEARCH → REPORT → Review |

### 4. 多技术栈支持

框架设计为栈无关，默认模板以 TypeScript 为例，可通过配置适配：
- Python (pytest, ruff)
- Go (go test, golangci-lint)
- Rust (cargo test, cargo clippy)
- Java (mvn test, checkstyle)

---

## Review History

| Round | Verdict | Issues | Changes |
|-------|---------|--------|---------|
| 1 | NEEDS_IMPROVEMENT | 5 MAJOR, 2 MINOR | 命令映射、config 统一、多栈支持、安全默认 |
| 2 | NEEDS_IMPROVEMENT | 1 MAJOR | after_tasks checkpoint 对齐 |
| 3 | PASS | None | - |

---

## Next Steps

1. **将模板复制到项目中**
   ```bash
   cp -r templates/* your-project/.agent/templates/
   ```

2. **创建首个功能规范**
   ```bash
   mkdir -p .agent/specs/feature-001
   cp .agent/templates/spec.md .agent/specs/feature-001/
   ```

3. **考虑实现 /specify, /plan, /tasks skills** (可选)
   - 将手动模板操作自动化
   - 参考 skill-generator skill

---

## Files Location

```
.tasks/self-review/ai-workflow-design-20260112/
├── 00-task-spec.md
├── workflow-design.md           # 主设计文档
├── templates/
│   ├── spec.md
│   ├── plan.md
│   ├── tasks.md
│   ├── config.yaml
│   ├── constitution.md
│   ├── CLAUDE.md
│   └── structure.md
├── evidence/
├── reviews/round-{1,2,3}/
├── improvements/
└── final-report.md
```

---

*Generated by Self-Review Skill | 2026-01-12*
