# SPECIFY Phase Design - Final Report

> **Task ID**: specify-phase-design-20260113
> **Date**: 2026-01-13
> **Status**: PASS (Reviewed by Codex, 4 rounds)

---

## Executive Summary

基于 SPECIFY 阶段调研结果，完成了详细的 SPECIFY 阶段实现设计，包括：
- 4 子阶段架构 (CAPTURE → CLARIFY → STRUCTURE → VALIDATE)
- 完整的输入/输出规范
- spec.md 模板设计 (9 章节 + Appendix)
- 模式感知的验收标准和 Checklist
- Skill 交互设计

---

## Deliverables

| 文件 | 描述 |
|------|------|
| `00-task-spec.md` | 任务规范 |
| `specify-phase-design.md` | 主设计文档 (~900 行) |
| `improvements/round-1-fixes.md` | 审查修复记录 |
| `reviews/round-{1,2,3,4}/` | 审查记录 |

---

## Key Design Decisions

### 1. 四子阶段模型

```
CAPTURE → CLARIFY → STRUCTURE → VALIDATE
  捕获      澄清      结构化      验证
```

**递归分解**:
- CAPTURE: Context Gathering, Stakeholder ID, Requirements Extraction
- CLARIFY: Ambiguity Detection, Question Generation, Resolution
- STRUCTURE: User Story Composition, AC Definition, Requirements Classification
- VALIDATE: Completeness Check, Consistency Check, Approval

### 2. 输入输出规范

| 阶段 | 输入 | 输出 |
|------|------|------|
| CAPTURE | 用户请求, CLAUDE.md | raw-notes.md + metrics |
| CLARIFY | raw-notes.md | clarified.md |
| STRUCTURE | clarified.md, 模板 | spec.md (草稿) |
| VALIDATE | spec.md (草稿) | spec.md (定稿) |

**关键指标**: `ambiguity_score`, `open_questions_count`

### 3. spec.md 模板结构

9 个核心章节 + 3 个附录:
1. Overview
2. Problem Statement
3. User Stories (含 AC)
4. Functional Requirements
5. Non-Functional Requirements
6. Constraints & Assumptions
7. Out of Scope
8. Open Questions
9. Acceptance Checklist
A. Glossary, B. References, C. Change History

### 4. 三种模板模式

| 模式 | 必需章节 | 适用场景 |
|------|----------|----------|
| Mini | 1, 3, 7, 9 | 简单 bug fix |
| Standard | 1-7, 9 | 中等功能 |
| Full | 全部 | 大型功能 |

### 5. Skill 交互设计

**命令格式**:
```bash
/specify [--mode=mini|standard|full] [--interactive|--guided|--auto] {需求描述}
/specify --resume {spec-id}
/specify --validate {spec-id}
```

**交互模式**:
- Interactive (默认): 每阶段暂停确认
- Guided: AI 提供选项，用户选择
- Auto: AI 决策，仅最终审批

---

## Review History

| Round | Verdict | Issues | Key Changes |
|-------|---------|--------|-------------|
| 1 | NEEDS_IMPROVEMENT | 1 MAJOR, 2 MINOR | 模式感知验证、命令文档、条件性验收 |
| 2 | NEEDS_IMPROVEMENT | 1 MAJOR, 1 MINOR | 章节标识符统一、skip_condition 定义 |
| 3 | NEEDS_IMPROVEMENT | 1 MAJOR | 模板表格与验证规则对齐 |
| 4 | PASS | None | - |

---

## Next Steps

1. **实现 /specify skill**
   - 参考 skill-generator 创建 SKILL.md
   - 实现四子阶段状态机
   - 集成 AskUserQuestion 交互

2. **创建模板文件**
   - `.agent/templates/spec-mini.md`
   - `.agent/templates/spec-standard.md`
   - `.agent/templates/spec-full.md`

3. **设计 Phase 2: PLAN**
   - 技术规划阶段的详细设计
   - 与 SPECIFY 输出的集成

---

## Files Location

```
.tasks/self-review/specify-phase-design-20260113/
├── 00-task-spec.md
├── specify-phase-design.md          # 主设计文档
├── improvements/
│   └── round-1-fixes.md             # Round 1-3 修复记录
├── reviews/
│   ├── round-1/review-response.md
│   ├── round-2/review-response.md
│   ├── round-3/review-response.md
│   └── round-4/review-response.md
└── final-report.md
```

---

*Generated by Self-Review Skill | 2026-01-13*
