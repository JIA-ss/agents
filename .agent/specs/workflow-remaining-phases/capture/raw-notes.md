# CAPTURE: AI 工作流后续阶段需求

> 捕获时间: 2026-01-14
> 功能 ID: workflow-remaining-phases

---

## 1. 项目上下文

### 1.1 已完成工作

| 阶段 | 产出 | 状态 |
|------|------|------|
| AI 工作流调研 | `.tasks/self-review/ai-workflow-research-20260112/` | ✅ 完成 |
| 框架初步设计 | `.tasks/self-review/ai-workflow-design-20260112/workflow-design.md` | ✅ 完成 |
| Specify 阶段调研 | `.tasks/self-review/specify-phase-research-20260113/` | ✅ 完成 |
| Specify 阶段设计 | `.tasks/self-review/specify-phase-design-20260113/` | ✅ 完成 |
| Specify Skill 实现 | `skills/specify/SKILL.md` | ✅ 完成 |

### 1.2 工作流框架设计（已定义）

```
SPECIFY → PLAN → TASK → IMPLEMENT → REVIEW → DELIVER
  ✅       ⬜     ⬜      ⬜         (部分)
```

**5 阶段模型**:
1. **SPECIFY** (规范): 定义"做什么"和"为什么" → 输出 `spec.md` ✅ 已实现
2. **PLAN** (计划): 定义"怎么做" → 输出 `plan.md` ⬜ 待实现
3. **TASK** (分解): 将计划分解为可执行任务 → 输出 `tasks.md` ⬜ 待实现
4. **IMPLEMENT** (实现): 执行任务，生成代码 → Code changes ⬜ 待实现
5. **REVIEW** (审查): 独立验证实现质量 → Review verdict (部分存在: `/self-review`)

### 1.3 现有相关 Skills

| Skill | 阶段 | 状态 | 说明 |
|-------|------|------|------|
| `/specify` | SPECIFY | ✅ 完整 | 5阶段流程，中文支持 |
| `/task-planner` | PLAN/TASK | ⚠️ 部分重叠 | 7阶段流程，输出 main-plan.md + tasks.md |
| `/task-dispatcher` | IMPLEMENT | ⚠️ 需集成 | DAG 调度，并行执行 |
| `/self-review` | REVIEW | ✅ 完整 | Codex 独立审查 |
| `/parallel-task-planner` | TASK | ⚠️ 辅助工具 | 识别并行机会 |
| `/task-code-reviewer` | REVIEW | ⚠️ 辅助工具 | 任务代码审查 |

---

## 2. 需求提取

### 2.1 核心需求

**用户原始表述**:
> "我需要搭建一套工作流，前面应该已经进行了 ai工作流的调研和框架初步设计，且已经完成了 specify 的阶段，接下来我想要完成后续的阶段"

**提取的需求点**:

| ID | 需求 | 类型 | 优先级 |
|----|------|------|--------|
| R1 | 实现 PLAN 阶段 skill | FR | P0 |
| R2 | 实现 TASK 阶段 skill | FR | P0 |
| R3 | 实现 IMPLEMENT 阶段 skill | FR | P0 |
| R4 | 集成现有 `/self-review` 到 REVIEW 阶段 | FR | P1 |
| R5 | 阶段间数据流转（spec.md → plan.md → tasks.md） | FR | P0 |
| R6 | 与现有 skills 的关系处理 | NFR | P1 |

### 2.2 约束条件

| 约束 | 来源 | 说明 |
|------|------|------|
| 目录结构 | workflow-design.md | 必须遵循 `.agent/specs/{feature}/` 结构 |
| 输出格式 | workflow-design.md | 必须输出 spec.md, plan.md, tasks.md |
| 技术栈无关 | workflow-design.md | 支持多种技术栈 |
| Skill 规范 | skill-best-practices-research | <500行, Progressive Disclosure |
| 中文支持 | 用户要求 | 所有 skill 使用中文描述 |

### 2.3 功能性需求详细

#### FR-PLAN: `/plan` Skill
- 输入: `spec.md`（来自 /specify 输出）
- 输出: `plan.md`
- 内容:
  - 技术方案
  - 架构决策
  - 依赖分析
  - 风险评估
- 检查点: Human Review

#### FR-TASK: `/task` Skill
- 输入: `plan.md`
- 输出: `tasks.md`
- 内容:
  - 任务列表（带优先级）
  - 并行标记 `[P]`
  - 依赖关系
  - 测试先行标记 `[T]`
- 检查点: Human Review

#### FR-IMPLEMENT: `/implement` Skill
- 输入: `tasks.md`, 当前任务
- 输出: Code changes, Tests
- 流程:
  1. 读取任务
  2. 若有 `[T]` 标记，先写测试
  3. 实现代码
  4. 运行测试
  5. 提交 (atomic commit)
- 检查点: Tests Pass

### 2.4 非功能性需求

| NFR | 描述 | 指标 |
|-----|------|------|
| NFR-1 | 与现有 skills 兼容 | 可调用 /task-planner, /task-dispatcher 等 |
| NFR-2 | 渐进式工作流 | 支持跳过部分阶段（Quick Mode） |
| NFR-3 | 状态可追溯 | 每阶段输出保存到 `.agent/specs/{feature}/` |

---

## 3. 待澄清问题

| 问题 ID | 问题 | 影响阶段 | 推荐默认值 |
|---------|------|----------|------------|
| Q1 | `/plan` 是否复用 `/task-planner` 的 7 阶段流程？还是设计新的流程？ | PLAN | 复用并适配 |
| Q2 | `/task` 与 `/parallel-task-planner` 如何集成？ | TASK | 内部调用 |
| Q3 | `/implement` 与 `/task-dispatcher` 的关系？ | IMPLEMENT | /implement 调用 /task-dispatcher |
| Q4 | 是否需要新的 `/deliver` skill？还是集成到 `/self-review`？ | REVIEW | 集成到 /self-review |
| Q5 | 各阶段 skill 是独立实现还是作为统一 `/workflow` skill 的子命令？ | 架构 | 独立实现，通过 spec 目录关联 |

---

## 4. 初步分析

### 4.1 Ambiguity Score

**得分**: 3/10 (较低歧义)

**主要不确定性**:
- 与现有 skills 的复用/重构边界
- 各 skill 的独立性 vs 统一入口

### 4.2 复杂度评估

| 维度 | 评估 | 说明 |
|------|------|------|
| 功能复杂度 | 中等 | 主要是适配和集成工作 |
| 技术复杂度 | 低 | 遵循已有的 skill 设计模式 |
| 集成复杂度 | 中等 | 需要处理与现有 skills 的关系 |

### 4.3 推荐方案方向

**Option A**: 最小实现（推荐）
- 创建 `/plan`, `/task`, `/implement` 三个独立 skills
- 每个 skill 内部可调用现有 skills（如 `/task-planner`）
- 保持现有 `/self-review` 作为 REVIEW 阶段

**Option B**: 统一入口
- 创建 `/workflow` skill 作为统一入口
- 子命令: `/workflow plan`, `/workflow task`, `/workflow implement`
- 更高集成度，但实现更复杂

---

## 5. 下一步

1. 进入 CLARIFY 阶段，解决 Q1-Q5 的不确定性
2. 基于用户反馈确定最终方案方向
3. 生成结构化的 spec.md

---

*Generated by /specify CAPTURE phase*
