---
name: xhs-workflow
description: 小红书内容创作全流程自动化。从热点调研到一键发布，涵盖趋势研究、选题策划、文案撰写、配图生成、质量审核、平台发布。当用户说"帮我创作小红书"、"写一篇小红书"、"发布小红书"、"/创作"、"/热点"、"/写文"时使用。也响应 "xhs", "小红书", "xhs workflow"。
---

# XHS Workflow

小红书内容创作全流程：RESEARCH → TOPIC → COPY → VISUAL → REVIEW → PUBLISH

> 关键约束（来自平台限制）：标题 ≤ 20 字、正文 ≤ 1000 字、配图需本地路径。

---

## 🚀 执行流程

**当此 skill 被触发时，你必须按以下流程执行：**

### 立即行动

1. 询问用户创作方向（类目/主题/账号定位），或直接使用 `$ARGUMENTS` 中的主题
2. 确认 MCP 服务状态：
   - `xiaohongshu-mcp` HTTP 服务是否在 `http://localhost:18060` 运行（发布必需）
   - `fal-ai` MCP 是否可用（配图必需）
3. 开始 Phase 1: RESEARCH

### 📋 进度追踪 Checklist

**复制此清单并逐项完成：**

```
- [ ] Phase 1: RESEARCH → 输出: 热点趋势报告
- [ ] Phase 2: TOPIC → 输出: 用户确认的选题 + 大纲（🔴 等待用户）
- [ ] Phase 3: COPY → 输出: 用户确认的标题 + 正文 + 标签（🔴 等待用户×2）
- [ ] Phase 4: VISUAL → 输出: 本地图片路径列表（图片已下载到 /tmp/xhs_post/）
      ↳ 循环: 用户不满意 → 重新生成指定图片
- [ ] Phase 5: REVIEW → 判定: PASS → PUBLISH / FAIL → 回退
      ↳ 自动修正: 标题超长 → 回退 COPY / 正文超长 → 自动精简
- [ ] Phase 6: PUBLISH → 输出: 发布结果（🔴 等待用户）
```

### ✅ 阶段完成验证

| 阶段 | 完成条件 | 下一步 |
|------|----------|--------|
| RESEARCH | 趋势报告已输出，含 TOP 话题 + 关键词 | → TOPIC |
| TOPIC | 用户已选择选题方案，大纲已生成 | → COPY |
| COPY | 用户已确认标题，正文+标签已生成 | → VISUAL |
| VISUAL | 所有图片已生成并下载到本地，用户满意 | → REVIEW |
| REVIEW | 平台限制检查全部通过，质量评分 ≥ 60 | → PUBLISH |
| PUBLISH | 用户确认，`publish_content` 调用成功 | → 结束 |

---

## ⚠️ 平台限制（必须在 REVIEW 阶段强制检查）

| 限制项 | 规则 | 违反时处理 |
|--------|------|-----------|
| 标题长度 | ≤ 20 个中文字/英文单词 | 自动回退 COPY 重写标题 |
| 正文长度 | ≤ 1000 字符（含标点）| 自动精简正文，保留核心内容 |
| 图片格式 | JPG/PNG 本地绝对路径 | 确保图片已下载到 `/tmp/xhs_post/` |
| 标签格式 | `tags` 参数传数组，**不要**写在正文里 | 从正文中提取 `#标签` 移入 tags 参数 |
| 绝对化用语 | 禁止"最"、"第一"、"100%"等 | 自动替换 |

---

## Phase 详情

### Phase 1: RESEARCH（趋势调研）`[趋势研究员]`

**你必须：**
1. 确认用户的类目/方向
2. 使用 `search_feeds` 搜索至少 **3 组关键词**（核心词 + 延伸词 + 话题词）
3. 对搜索结果中点赞量 TOP 3 的帖子调用 `get_feed_detail` 获取完整内容
4. 分析高赞帖子的：标题模式、内容结构、标签策略、互动引导方式

**输出格式**：
```
📊 热点趋势报告
━━━━━━━━━━━━━━━━━━
🔥 热门话题 TOP 5：[话题] — [点赞数/收藏数] — [简评]
💡 热门内容角度：[角度] — [为什么火]
🏷️ 高频关键词：[词1] | [词2] | [词3]
📈 趋势洞察：[2-3 句总结]
```

**完成标志**：趋势报告已输出，提炼出 5+ 关键词和 3+ 热门角度

---

### Phase 2: TOPIC（选题策划）`[选题策划师]`

**你必须：**
1. 基于趋势报告生成 **3-5 个选题方案**，每个方案包含：
   - 标题方向（预计 15-20 字）
   - 目标受众
   - 切入角度
   - 差异化亮点
   - 预估效果
2. 呈现方案给用户选择
3. 🔴 **等待用户选择（A/B/C/D 或自定义方向）**
4. 根据用户选择生成内容大纲（5-7 个要点）

**完成标志**：用户已确认选题，内容大纲已生成

---

### Phase 3: COPY（文案撰写）`[文案撰稿人]`

**Step 3a - 标题（🔴 需用户确认）：**
1. 按小红书文风生成 **5 个标题候选**，每个标题：
   - 长度：15-20 字（**硬约束：不超过 20 字**）
   - 含 1-2 个核心关键词
   - 使用 emoji 开头或穿插
   - 套路：数字型 / 反问型 / 惊叹型 / 对比型 / 种草型
   - 禁用：最、第一、100% 等绝对化用语
2. 🔴 **等待用户选择标题（1-5 或自定义）**

**Step 3b - 正文（标题确认后执行）：**
1. 按用户确认的标题和大纲撰写正文：
   - 长度：**600-900 字（硬约束：不超过 950 字，为标签留空间）**
   - 结构：开头共鸣（1-2句）→ 正文分段（每段 2-4 句）→ 结尾互动引导
   - 排版：emoji 段落分隔、【】标注重点、数字/emoji 编号列举
   - 语气：亲切口语化，像和朋友聊天
2. 生成标签（8-12 个）：
   - 核心标签 3-5 个（高流量）
   - 长尾标签 3-4 个（精准）
   - 话题标签 2-3 个（平台话题）
   - **标签只放在 tags 参数，不写在正文里**

**完成标志**：用户已确认标题，完整正文+标签已生成，字符数 ≤ 950

---

### Phase 4: VISUAL（配图生成）`[视觉总监]`

**初始规划：**
1. 根据内容设计 **5-6 张图片**方案（封面必须是第一张）
2. 封面图要求：主题鲜明、有标题文字、竖版 portrait_3_4

**图片生成规则：**

| 步骤 | 工具 | 说明 |
|------|------|------|
| 生成图片 | `generate_image` 或 `generate_image_structured` | 模型推荐：`fal-ai/nano-banana-2`（Gemini 3.1 Flash Image）|
| 去背景 | `remove_background` | 处理 logo/贴纸类素材 |
| 合成 logo | `compose_images` | 注意：坐标是左上角偏移，非中心 |
| 编辑调整 | `edit_image` | 局部修改，无需重新生成整张图 |

**可用图片尺寸（必须使用以下之一）：**
- `portrait_3_4`（小红书推荐竖版）
- `portrait_9_16`（全屏竖版）
- `square`（方形）
- `landscape_4_3`（横版）
- `landscape_16_9`（宽屏）

**Logo 处理注意事项：**
- SVG 文件需先转 PNG（依赖 cairo：`brew install cairo && uv tool install cairosvg`）
- 建议优先让 AI 自由生成能传达品牌感的图形，而非强制嵌入官方 logo

**下载图片到本地（发布必需）：**
```bash
mkdir -p /tmp/xhs_post
curl -s -o /tmp/xhs_post/1_cover.png "<image_url>"
# 依次下载所有图片
```

**循环条件：**
- 用户对某张图不满意 → 对该图使用 `edit_image`（局部调整）或重新 `generate_image`
- 不需要全部重新生成，只重做指定图片

**完成标志**：所有图片已下载到 `/tmp/xhs_post/`，用户表示满意

---

### Phase 5: REVIEW（质量审核）`[质量审核员]`

**必须按以下顺序检查，发现问题立即处理：**

**Step 5a - 平台硬限制（优先检查）：**
```
- [ ] 标题字符数 ≤ 20 → 违反：回退 Phase 3 重写标题
- [ ] 正文字符数 ≤ 1000 → 违反：自动精简，保留核心段落，删除冗余描述
- [ ] 无绝对化用语（最/第一/100%）→ 违反：自动替换
- [ ] 标签在 tags 参数中，不在正文里 → 违反：从正文提取移出
- [ ] 图片文件路径存在 → 违反：重新下载
```

**Step 5b - 内容质量评分（100分制）：**

| 维度 | 分值 | 评分标准 |
|------|------|---------|
| 标题吸引力 | 25 | 含关键词、有套路、长度适中、有 emoji |
| 正文质量 | 35 | 结构清晰、口语化、有互动引导、信息密度适中 |
| 合规性 | 通过/不通过 | 无敏感词/虚假宣传/违禁内容 |
| SEO 优化 | 20 | 关键词自然融入、标签覆盖大中小流量 |
| 爆款潜力 | 20 | 切中热点、有传播性、有收藏价值 |

**判定规则：**

| 判定 | 条件 | 处理 |
|------|------|------|
| **PASS** | 合规通过 且 总分 ≥ 60 | → PUBLISH |
| **NEEDS_COPY** | 总分 < 60 或 标题/正文硬限制违反 | → 回退 Phase 3 |
| **REJECTED** | 合规不通过（含违禁词/虚假宣传）| → 回退 Phase 3，明确说明问题 |

**完成标志**：所有硬限制通过，质量评分 ≥ 60，判定为 PASS

---

### Phase 6: PUBLISH（发布运营）`[发布运营]`

**Step 6a - 发布前预览：**
展示最终成品：
```
📝 最终笔记预览
━━━━━━━━━━━━━━━━━━
【标题】<标题>
【字数】<正文字数>/1000
【标签】<标签列表>
【配图】<图片数量> 张，路径：/tmp/xhs_post/
【建议发布时间】工作日 20:00-21:00 / 午休 12:00-13:00
```

**Step 6b - 等待用户确认（🔴）：**
```
确认发布吗？
1. 立即发布
2. 定时发布（请告知时间）
3. 需要修改（请说明）
```

**Step 6c - 执行发布：**
调用 `publish_content`（xiaohongshu-mcp），参数格式：
```
title: <标题，≤20字>
content: <正文，≤1000字符，不含#标签>
images: ["/tmp/xhs_post/1_cover.png", ...]  // 本地绝对路径
tags: ["标签1", "标签2", ...]  // 不加 # 号
schedule_at: "2024-01-20T20:00:00+08:00"  // 可选，定时发布
```

**常见错误处理：**

| 错误 | 原因 | 处理 |
|------|------|------|
| MCP 工具不可用 | 服务未启动 | 提示运行 `cd ~/git_Proj/daily && ./bin/xiaohongshu-mcp` |
| 标题长度超限 | 标题超过 20 字 | 回退 Phase 5 → Phase 3 重写 |
| 正文长度超限 | 正文超过 1000 字符 | 回退 Phase 5 自动精简 |
| 登录已过期 | Cookie 失效 | 提示运行 `./bin/xiaohongshu-login` 重新扫码 |

**发布后运营建议：**
1. 发布后 30 分钟内在评论区置顶 GitHub 链接（正文不能放超链接）
2. 主动回复前 10 条评论，提升互动权重
3. 3 天后看数据，收藏率 > 点赞率说明内容有价值

**完成标志**：`publish_content` 返回成功，笔记已发布

---

## 快捷模式

| 指令 | 触发词 | 跳过阶段 | 执行范围 |
|------|--------|---------|---------|
| `/创作 <主题>` | "帮我创作"、"写一篇" | 无 | Phase 1-6 全流程 |
| `/热点 <类目>` | "热点"、"什么火" | Phase 2-6 | 只做 Phase 1 |
| `/选题 <关键词>` | "选题"、"想写什么" | Phase 3-6 | Phase 1-2 |
| `/写文 <主题>` | "写文"、"写文案" | Phase 1-2 | Phase 3-5（以主题为已确认选题）|
| `/发布` | "发布"、"发出去" | Phase 1-5 | 只做 Phase 6 |

---

## 集成

**依赖 MCP 服务：**
- `xiaohongshu-mcp`（HTTP）：`search_feeds`、`get_feed_detail`、`publish_content`
  - 启动命令：`cd ~/git_Proj/daily && ./bin/xiaohongshu-mcp`
- `fal-ai`（内置）：`generate_image`、`remove_background`、`compose_images`、`edit_image`

**输入**：用户提供的主题/方向（可选）
**输出**：已发布的小红书笔记 + 运营建议
