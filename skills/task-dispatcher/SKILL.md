---
name: task-dispatcher
description: 根据任务规划文档进行任务分发、调度和开发执行，支持并行任务编排和进度跟踪，确保按依赖顺序高效完成所有任务。当用户要求"执行任务计划"、"分发任务"、"运行任务调度"，或提到"任务执行"、"DAG 调度"、"进度跟踪"时使用。也响应 "execute task plan", "dispatch tasks", "run task scheduler"。
---

# Task Dispatcher

任务调度与执行：LOAD → SCHEDULE → EXECUTE → SYNC → COMPLETE

---

## 🚀 执行流程

**当此 skill 被触发时，你必须按以下流程执行：**

### 立即行动

1. 定位任务规划文档
2. 验证文档格式和依赖完整性
3. 开始 Phase 1: LOAD

### 📋 进度追踪 Checklist

**复制此清单并逐项完成：**

```
- [ ] Phase 1: LOAD → 读取文档，构建任务 DAG
- [ ] Phase 2: SCHEDULE → 拓扑排序，划分并行批次
- [ ] Phase 3: EXECUTE → 按批次执行任务
- [ ] Phase 4: SYNC → 更新状态，生成进度报告
- [ ] Phase 5: COMPLETE → 验证完成，输出最终状态
```

### ✅ 阶段完成验证

| 阶段 | 完成条件 | 下一步 |
|------|----------|--------|
| LOAD | DAG 已构建，无循环依赖 | → SCHEDULE |
| SCHEDULE | 批次已划分 | → EXECUTE |
| EXECUTE | 当前批次已执行 | → SYNC |
| SYNC | 状态已更新 | → EXECUTE (下一批次) 或 COMPLETE |
| COMPLETE | 所有任务完成/失败处理完毕 | → 结束 |

---

## Phase 详情

### Phase 1: LOAD（加载任务）

**你必须：**
1. 读取规划文档，提取任务清单
2. 解析每个任务：ID、标题、依赖、优先级、状态
3. 构建有向无环图（DAG）
4. 检测循环依赖（如有则中止）

**完成标志**: DAG 已构建，无循环依赖

---

### Phase 2: SCHEDULE（调度规划）

**你必须：**
1. 拓扑排序确定执行顺序（Kahn 算法）
2. 划分并行批次：
   - 批次 1: 入度为 0 的任务
   - 批次 2: 批次 1 完成后入度变为 0 的任务
   - ...
3. 计算关键路径
4. 生成 `execution-plan.md`

**完成标志**: 批次已划分

---

### Phase 3: EXECUTE（执行任务）

**你必须：**
1. 按批次顺序执行
2. 同批次内的任务可使用 Task 工具并行执行
3. 标记任务状态：
   - `[~]` 进行中
   - `[x]` 已完成
   - `[!]` 失败
   - `[-]` 跳过
4. 记录执行日志

**失败处理**:
| 策略 | 适用场景 | 影响 |
|------|----------|------|
| Retry | 临时性错误 | 重新执行 |
| Skip | 非关键任务 | 跳过后续依赖任务 |
| Abort | 关键任务失败 | 停止整个流程 |

**完成标志**: 当前批次已执行

---

### Phase 4: SYNC（同步状态）

**你必须：**
1. 更新规划文档中的任务状态
2. 生成/更新 `progress-report.md`：
   - 完成率
   - 模块进度
   - 阻塞分析
3. 判断是否继续下一批次

**完成标志**: 状态已更新

---

### Phase 5: COMPLETE（完成验证）

**你必须：**
1. 验证所有任务状态
2. 汇总执行结果
3. 输出最终状态报告
4. 如有失败任务，提供后续建议

**完成标志**: 所有任务完成/失败处理完毕

---

## 任务状态

| 状态 | 标记 | 说明 |
|------|------|------|
| 待执行 | `[ ]` | 尚未开始 |
| 进行中 | `[~]` | 正在执行 |
| 已完成 | `[x]` | 成功完成 |
| 失败 | `[!]` | 执行失败 |
| 跳过 | `[-]` | 被跳过 |

---

## 约束

- 最大并行任务数：5（避免资源竞争）
- 依赖必须在文档中明确标注
- 任务粒度：30min - 4h
- 检测到循环依赖时中止调度
