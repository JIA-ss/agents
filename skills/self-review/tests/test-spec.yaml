# Self-Review Skill Test Specification
# TDD æµ‹è¯•è§„èŒƒ - éªŒè¯ self-review skill çš„æ‰€æœ‰ä½¿ç”¨åœºæ™¯

skill:
  name: "self-review"
  description: "Execute tasks with independent AI review cycles using Codex"
  version: "1.0.0"

# éªŒè¯è§„åˆ™
validation:
  required_sections:
    - "ğŸš€ æ‰§è¡Œæµç¨‹"
    - "ğŸ“‹ è¿›åº¦è¿½è¸ª Checklist"
    - "âœ… é˜¶æ®µå®ŒæˆéªŒè¯"
    - "Phase è¯¦æƒ…"

  forbidden_words_in_name:
    - "anthropic"
    - "claude"

  max_lines: 500

  required_test_types:
    - trigger
    - execution
    - edge
    - negative

# æµ‹è¯•åœºæ™¯
scenarios:
  # ========== Trigger Tests (è§¦å‘æµ‹è¯•) ==========
  - id: "trigger-chinese-self-supervision"
    name: "ä¸­æ–‡è§¦å‘ - è‡ªæˆ‘ç›‘ç£"
    type: "trigger"
    query: "å¸®æˆ‘æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œéœ€è¦è‡ªæˆ‘ç›‘ç£ç¡®ä¿è´¨é‡"
    expected_behavior:
      - "Skill è¢«è§¦å‘"
      - "è¯†åˆ«ä¸ºéœ€è¦ self-review çš„ä»»åŠ¡"
      - "å¼€å§‹ Phase 1: Task Confirmation"

  - id: "trigger-chinese-iterative-review"
    name: "ä¸­æ–‡è§¦å‘ - è¿­ä»£å®¡æŸ¥"
    type: "trigger"
    query: "ç”¨è¿­ä»£å®¡æŸ¥çš„æ–¹å¼æ¥å®Œæˆä»£ç é‡æ„"
    expected_behavior:
      - "Skill è¢«è§¦å‘"
      - "åˆ›å»ºä»»åŠ¡ç›®å½•"
      - "ç”Ÿæˆ task-name"

  - id: "trigger-english-self-review"
    name: "è‹±æ–‡è§¦å‘ - self-review"
    type: "trigger"
    query: "Execute this task with self-review cycles"
    expected_behavior:
      - "Skill activates"
      - "Creates .tasks/self-review/{task-name}/ directory"
      - "Starts Phase 1"

  - id: "trigger-quality-loop"
    name: "è§¦å‘ - è´¨é‡å¾ªç¯å…³é”®è¯"
    type: "trigger"
    query: "éœ€è¦è´¨é‡å¾ªç¯æ¥ç¡®ä¿ä»£ç æ²¡æœ‰é—®é¢˜"
    expected_behavior:
      - "Skill è¢«è§¦å‘"
      - "è¯†åˆ«è´¨é‡å¾ªç¯è¯·æ±‚"
      - "å¼€å§‹æ‰§è¡Œæµç¨‹"

  # ========== Execution Tests (æ‰§è¡Œæµ‹è¯•) ==========
  - id: "exec-full-workflow"
    name: "å®Œæ•´å·¥ä½œæµæ‰§è¡Œ"
    type: "execution"
    query: "ä½¿ç”¨ self-review å®Œæˆä¸€ä¸ªç®€å•çš„ä»£ç ä¿®æ”¹ä»»åŠ¡"
    expected_behavior:
      - "Phase 1: åˆ›å»º 00-task-spec.md"
      - "Phase 2: æ‰§è¡Œä»»åŠ¡å¹¶ç”Ÿæˆ evidence/"
      - "Phase 3: è°ƒç”¨ Codex è¿›è¡Œç‹¬ç«‹å®¡æŸ¥"
      - "Phase 4: åˆ†æå®¡æŸ¥ç»“æœ"
      - "Phase 6: ç”Ÿæˆ final-report.md (å¦‚ PASS)"

  - id: "exec-phase1-task-confirmation"
    name: "Phase 1 æ‰§è¡ŒéªŒè¯"
    type: "execution"
    query: "åˆ›å»ºä¸€ä¸ª self-review ä»»åŠ¡è§„èŒƒ"
    expected_behavior:
      - "åˆ›å»ºç›®å½• .tasks/self-review/{task-name}/"
      - "ä½¿ç”¨ task-spec.md æ¨¡æ¿"
      - "å¡«å†™ä»»åŠ¡æè¿°å’ŒéªŒæ”¶æ ‡å‡†"
      - "ç”Ÿæˆ 00-task-spec.md"

  - id: "exec-phase2-evidence-generation"
    name: "Phase 2 è¯æ®ç”ŸæˆéªŒè¯"
    type: "execution"
    query: "æ‰§è¡Œä»»åŠ¡å¹¶ç”Ÿæˆè¯æ®æ–‡ä»¶"
    expected_behavior:
      - "åˆ›å»º evidence/ ç›®å½•"
      - "ç”Ÿæˆ execution-manifest.json"
      - "ç”Ÿæˆ test-results.txt"
      - "ç”Ÿæˆ requirement-mapping.md"
      - "ç›®å½•åŒ…å«è‡³å°‘ 3 ä¸ªæ–‡ä»¶"

  - id: "exec-phase3-codex-review"
    name: "Phase 3 Codex ç‹¬ç«‹å®¡æŸ¥"
    type: "execution"
    query: "å¯¹å·²å®Œæˆçš„ä»»åŠ¡è¿›è¡Œç‹¬ç«‹å®¡æŸ¥"
    expected_behavior:
      - "åˆ›å»º reviews/round-{N}/ ç›®å½•"
      - "å‡†å¤‡ review-prompt.md"
      - "è°ƒç”¨ Codex è¿›è¡Œå®¡æŸ¥"
      - "ä¿å­˜ç»“æœåˆ° review-response.md"

  - id: "exec-phase4-verdict"
    name: "Phase 4 åˆ¤å®šé€»è¾‘éªŒè¯"
    type: "execution"
    query: "åˆ†æå®¡æŸ¥ç»“æœå¹¶å¾—å‡ºåˆ¤å®š"
    expected_behavior:
      - "ç»Ÿè®¡ blocker/critical/major/minor æ•°é‡"
      - "åº”ç”¨åˆ¤å®šè§„åˆ™"
      - "è¾“å‡º PASS/NEEDS_IMPROVEMENT/REJECTED"

  - id: "exec-improvement-loop"
    name: "æ”¹è¿›å¾ªç¯æ‰§è¡Œ"
    type: "execution"
    query: "å®¡æŸ¥å‘ç°é—®é¢˜åè¿›è¡Œæ”¹è¿›"
    expected_behavior:
      - "åˆ›å»º improvements/round-{N}-changes.md"
      - "è®°å½•éœ€è¦ä¿®å¤çš„é—®é¢˜"
      - "æ‰§è¡Œä¿®å¤"
      - "è¿”å› Phase 2 é‡æ–°ç”Ÿæˆè¯æ®"

  # ========== Edge Tests (è¾¹ç•Œæµ‹è¯•) ==========
  - id: "edge-minimal-task"
    name: "æœ€å°è¾“å…¥ä»»åŠ¡"
    type: "edge"
    query: "self-review"
    expected_behavior:
      - "è¯·æ±‚æ›´å¤šä»»åŠ¡è¯¦æƒ…"
      - "æç¤ºç”¨æˆ·æä¾›å…·ä½“ä»»åŠ¡æè¿°"

  - id: "edge-max-rounds"
    name: "æœ€å¤§å®¡æŸ¥è½®æ¬¡é™åˆ¶"
    type: "edge"
    query: "ç¬¬ä¸‰è½®å®¡æŸ¥ä»ç„¶ NEEDS_IMPROVEMENT"
    expected_behavior:
      - "æ£€æµ‹åˆ° round >= 3"
      - "ä¸å†ç»§ç»­æ”¹è¿›å¾ªç¯"
      - "ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Šå¹¶æ ‡è®°çŠ¶æ€"

  - id: "edge-rejected-verdict"
    name: "REJECTED åˆ¤å®šå¤„ç†"
    type: "edge"
    query: "å®¡æŸ¥ç»“æœåŒ…å« blocker çº§åˆ«é—®é¢˜"
    expected_behavior:
      - "åˆ¤å®šä¸º REJECTED"
      - "ä¸è¿›å…¥æ”¹è¿›å¾ªç¯"
      - "ç”ŸæˆæŠ¥å‘Šè¯´æ˜æ‹’ç»åŸå› "

  - id: "edge-empty-evidence"
    name: "ç©ºè¯æ®ç›®å½•å¤„ç†"
    type: "edge"
    query: "Phase 2 æœªèƒ½ç”Ÿæˆè¶³å¤Ÿè¯æ®"
    expected_behavior:
      - "æ£€æµ‹åˆ° evidence/ æ–‡ä»¶æ•° < 3"
      - "æç¤ºéœ€è¦è¡¥å……è¯æ®"
      - "ä¸è¿›å…¥ Phase 3"

  # ========== Negative Tests (åå‘æµ‹è¯•) ==========
  - id: "negative-simple-question"
    name: "ç®€å•é—®é¢˜ä¸è§¦å‘"
    type: "negative"
    query: "ä»€ä¹ˆæ˜¯ä»£ç å®¡æŸ¥ï¼Ÿ"
    expected_behavior:
      - "Skill ä¸è¢«è§¦å‘"
      - "å½“ä½œæ™®é€šé—®é¢˜å›ç­”"

  - id: "negative-unrelated-task"
    name: "æ— å…³ä»»åŠ¡ä¸è§¦å‘"
    type: "negative"
    query: "å¸®æˆ‘å†™ä¸€ä¸ª hello world ç¨‹åº"
    expected_behavior:
      - "Skill ä¸è¢«è§¦å‘"
      - "ç›´æ¥æ‰§è¡Œç®€å•ä»»åŠ¡"

  - id: "negative-manual-review"
    name: "æ‰‹åŠ¨å®¡æŸ¥è¯·æ±‚ä¸è§¦å‘"
    type: "negative"
    query: "å¸®æˆ‘çœ‹çœ‹è¿™æ®µä»£ç æœ‰æ²¡æœ‰é—®é¢˜"
    expected_behavior:
      - "Skill ä¸è¢«è§¦å‘"
      - "è¿›è¡Œæ™®é€šä»£ç å®¡æŸ¥"

  # ========== Error Tests (é”™è¯¯å¤„ç†æµ‹è¯•) ==========
  - id: "error-codex-unavailable"
    name: "Codex ä¸å¯ç”¨å¤„ç†"
    type: "error"
    query: "Codex è°ƒç”¨å¤±è´¥æ—¶çš„å¤„ç†"
    expected_behavior:
      - "æ£€æµ‹åˆ° Codex è°ƒç”¨å¤±è´¥"
      - "è®°å½•é”™è¯¯ä¿¡æ¯"
      - "æä¾›å¤‡é€‰æ–¹æ¡ˆæˆ–é‡è¯•"

  - id: "error-directory-permission"
    name: "ç›®å½•æƒé™é”™è¯¯å¤„ç†"
    type: "error"
    query: "æ— æ³•åˆ›å»ºä»»åŠ¡ç›®å½•"
    expected_behavior:
      - "æ£€æµ‹åˆ°ç›®å½•åˆ›å»ºå¤±è´¥"
      - "æç¤ºæƒé™é—®é¢˜"
      - "å»ºè®®è§£å†³æ–¹æ¡ˆ"
