---
name: task-code-reviewer
description: 基于任务规划文档检查代码实现的完成度、时序依赖、逻辑正确性和框架集成，输出结构化的代码审查报告。当用户要求"审查代码与计划的一致性"、"检查实现完成度"、"验证任务实现"，或提到"任务审查"、"计划合规"时使用。也响应 "review code against plan", "check implementation completeness", "validate task implementation"。
---

# Task Code Reviewer

基于规划的代码审查：LOAD → DETECT → CHECK → ANALYZE → REPORT

---

## 🚀 执行流程

**当此 skill 被触发时，你必须按以下流程执行：**

### 立即行动

1. 定位任务规划文档（`.tasks/` 目录）
2. 识别待审查的代码范围
3. 开始 Phase 1: LOAD

### 📋 进度追踪 Checklist

**复制此清单并逐项完成：**

```
- [ ] Phase 1: LOAD → 解析规划文档，提取模块和验收标准
- [ ] Phase 2: DETECT → 检测代码变更，映射到规划模块
- [ ] Phase 3: CHECK → 完成度检查、依赖验证
- [ ] Phase 4: ANALYZE → 逻辑分析、框架集成检查
- [ ] Phase 5: REPORT → 输出结构化审查报告
```

### ✅ 阶段完成验证

| 阶段 | 完成条件 | 下一步 |
|------|----------|--------|
| LOAD | 规划文档已解析 | → DETECT |
| DETECT | 变更已检测并映射 | → CHECK |
| CHECK | 完成度和依赖已验证 | → ANALYZE |
| ANALYZE | 逻辑和集成已分析 | → REPORT |
| REPORT | 审查报告已输出 | → 结束 |

---

## Phase 详情

### Phase 1: LOAD（加载规划）

**你必须：**
1. 读取 `.tasks/` 下的规划文档
2. 提取模块列表、依赖关系、验收标准
3. 构建规划模型

**完成标志**: 规划文档已解析

---

### Phase 2: DETECT（检测变更）

**你必须：**
1. 运行 `git diff` 分析变更
2. 分类变更文件（新增/修改/删除）
3. 将变更映射到规划中的模块
4. 标记未关联到规划的变更

**完成标志**: 变更已检测并映射

---

### Phase 3: CHECK（检查完成度）

**你必须：**
1. **完成度检查**：
   - 模块是否实现
   - 核心函数是否存在
   - 接口定义是否匹配
2. **依赖验证**：
   - 时序依赖：A 依赖 B，B 是否完成
   - 数据依赖：使用的数据结构是否定义
   - 初始化顺序：依赖服务是否先初始化

**完成标志**: 完成度和依赖已验证

---

### Phase 4: ANALYZE（深度分析）

**你必须：**
1. **逻辑分析**：
   - 边界条件检查
   - 异常路径处理
   - 状态一致性
2. **框架集成**：
   - 代码模式符合规范
   - 命名规范一致
   - 文件组织正确
3. **扩展检查**（按优先级）：
   - 必需：输入验证、认证授权、敏感数据
   - 重要：错误处理、日志记录
   - 可选：代码复杂度、重复代码

**完成标志**: 逻辑和集成已分析

---

### Phase 5: REPORT（输出报告）

**你必须：**
1. **执行摘要**：总体状态、各维度评分、Top 3 问题
2. **详细分析**：规划对齐、完成度、依赖、逻辑、集成
3. **改进建议**：按高/中/低优先级分组
4. **文件索引**：路径、变更类型、关联模块、问题数

**完成标志**: 审查报告已输出

---

## 检查维度

| 维度 | 检查项 |
|------|--------|
| 完成度 | 模块实现、核心函数、接口定义、任务清单 |
| 依赖 | 时序依赖、数据依赖、初始化顺序、模块依赖 |
| 逻辑 | 边界条件、异常路径、状态一致性、竞态条件 |
| 集成 | 代码模式、命名规范、文件组织、架构层级 |

---

## 最佳实践

1. 先用 task-planner 生成规划再开发
2. 增量提交，增量审查
3. 优先处理执行摘要中的 Top 3 问题
4. 根据审查报告调整开发实践
