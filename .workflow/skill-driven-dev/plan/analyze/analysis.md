# 需求分析: Skill 驱动开发模式

> **分析日期**: 2026-02-09
> **Spec 版本**: 0.2 (approved)

---

## 1. 功能需求摘要

| ID | 需求 | 来源 | 技术影响 | 验收方式 | 优先级 | 需调研 |
|----|------|------|----------|----------|--------|--------|
| FR-1 | CLAUDE.local.md 标准化结构 | US-1, US-2 | 模板设计、Skill 注册表格式 | 模板验证 | P0 | 否 |
| FR-2 | Skill 索引含名称、功能域、关联 Skill | US-1 | 索引格式设计、自动生成机制 | 格式验证 | P0 | 是 |
| FR-3 | SKILL.md 统一格式标准 | US-3 | 模板设计、必选/可选章节定义 | 格式验证 | P0 | 否 |
| FR-4 | Skill 自迭代机制 | US-4, US-5 | .evolution/ 目录结构、脚本设计 | 功能验证 | P1 | 否 |
| FR-5 | Sync 规则清单 | US-2 | 变更分类体系、判断逻辑 | 规则验证 | P0 | 否 |
| FR-6 | 项目总纲初始化模板 | US-3 | 模板文件 | 端到端验证 | P0 | 否 |
| FR-7 | Skill 模板和特性识别指南 | US-3 | 模板文件、指南文档 | 端到端验证 | P0 | 否 |
| FR-8 | Skill 创建/废弃/合并规则 | US-4 | 规则文档、流程设计 | 文档验证 | P1 | 否 |

---

## 2. 非功能需求摘要

| ID | 需求 | 质量属性 | 量化指标 | 来源 | 验收方式 | 优先级 |
|----|------|----------|----------|------|----------|--------|
| NFR-1 | Sync 判断低摩擦 | 可用性 | ≤10 秒判断，≤2 步确认 | US-2 | 计时测试 | P0 |
| NFR-2 | 技术栈兼容 | 可移植性 | ≥3 种技术栈验证 | US-3 | 多项目验证 | P1 |
| NFR-3 | 渐进式采纳 | 可用性 | 最小集 = 总纲 + 1 Skill | US-3 | 端到端验证 | P0 |
| NFR-4 | 平台兼容 | 兼容性 | 兼容 .claude/ 和 frontmatter | 约束 | 格式验证 | P0 |
| NFR-5 | 向后兼容 | 可维护性 | 模板更新不影响已有 Skill | NFR | 回归测试 | P1 |

---

## 3. 技术约束

- 约束 1: 必须基于 Claude Code Skills 机制（SKILL.md + frontmatter）
- 约束 2: 必须兼容 `.claude/` 目录结构
- 约束 3: 所有 Skill 文件纳入 Git 版本控制
- 约束 4: render-pipeline 项目现有体系作为基准参考实现

---

## 4. 范围与非目标

### 范围

- CLAUDE.local.md 标准模板设计
- SKILL.md 标准模板设计
- Skill 索引机制（含自动生成可行性）
- 智能 Sync 规则体系
- 特性识别与 Skill 拆分指南
- Skill 生命周期规则
- .evolution/ 自迭代机制标准化
- 跨技术栈适配示例

### 非目标

- CI/CD 集成（第二阶段）
- Skill 内容自动生成（已有 /skill-generator）
- 各 Skill 具体内容编写
- 非 Claude Code 工具适配

---

## 5. 待决策点

- [x] 决策点 1: Skill 发现机制采用什么方案？（需调研 → 见调研主题 1）
- [x] 决策点 2: Skill 索引是否可以自动生成？（需调研 → 见调研主题 2）
- [ ] 决策点 3: CLAUDE.local.md 应采用何种结构组织 Skill 信息？（基于调研结果决定）
- [ ] 决策点 4: Sync 规则应嵌入 CLAUDE.local.md 还是独立管理？（架构决策）
- [ ] 决策点 5: .evolution/ 机制保持现有设计还是简化？（架构决策）

---

## 6. 调研主题

| 主题 | 原因 | 优先级 | 状态 |
|------|------|--------|------|
| Claude Code Skill 发现与匹配机制 | 需要理解 Claude Code 原生如何匹配 Skill，以设计最优的发现策略（索引 vs frontmatter vs 混合） | P0 | 待调研 |
| Skill 索引自动生成可行性 | 验证假设 A-3：能否通过脚本扫描 .claude/skills/ 自动生成索引，减少人工维护成本 | P0 | 待调研 |

---

## 7. 假设与风险

| ID | 假设/风险 | 影响 | 缓解策略 |
|----|-----------|------|----------|
| AR-01 | 假设：Claude Code 的 frontmatter description 匹配机制已足够准确 | 中 | 通过调研验证；若不足，增加 CLAUDE.local.md 中的显式索引辅助 |
| AR-02 | 假设：脚本可自动生成 Skill 索引 | 中 | 通过调研验证；若不可行，设计低成本手动维护流程 |
| AR-03 | 风险：团队在 Skill 数量增长时发现维护负担过重 | 高 | 设计渐进式采纳策略，确保最小集可用 |
| AR-04 | 风险：不同技术栈项目的 Skill 结构差异过大 | 中 | 模板设计为通用框架 + 技术栈特定扩展 |
| AR-05 | 风险：Sync 规则过严导致开发者抵触 | 高 | Sync 规则默认宽松（仅外部接口变化触发），可逐步收紧 |

---

## 8. 现有代码库分析

### 8.1 相关模块（现有参考实现）

- **CLAUDE.local.md** (`render-pipeline/CLAUDE.local.md`): 已有总纲结构，含 Skill 驱动开发流程、智能 Sync 规则、证据驱动原则、Git 规范
- **Skills 目录** (`render-pipeline/.claude/skills/`): ~15 个 Skill，每个含 SKILL.md + .evolution/ + tests/
- **Skill Generator** (`agents/skills/skill-generator/`): 已有 Skill 生成工具，含模板和验证脚本

### 8.2 可复用组件

- 现有 CLAUDE.local.md 的 Skill 驱动开发流程定义 → 可提取为通用模板
- 现有 SKILL.md 格式（frontmatter + 标准章节） → 可提取为标准模板
- 现有 .evolution/ 机制（config.yaml + changelog + 4 子目录） → 可直接标准化
- 现有智能 Sync 规则表 → 可泛化为通用变更分类体系
- 现有 skill-generator 的模板 → 可作为标准 SKILL.md 模板的基础

### 8.3 需要新建的文件

- `templates/CLAUDE.local.template.md`: 项目总纲初始化模板
- `templates/SKILL.template.md`: Skill 文档标准模板
- `guides/feature-identification.md`: 特性识别与 Skill 拆分指南
- `guides/skill-lifecycle.md`: Skill 生命周期管理规则
- `guides/quick-start.md`: 新项目快速接入指南
- `scripts/generate-skill-index.sh`: Skill 索引自动生成脚本（待调研验证）

---

*Generated by workflow-plan (ANALYZE) | 2026-02-09*
